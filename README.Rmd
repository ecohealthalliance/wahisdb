---
output: github_document
params:
  maintainer: Emma Mendelsohn
  maintainer_email: schwantes@ecohealthalliance.org
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# wahisdb

[![License (for code): MIT](https://img.shields.io/badge/License (for code)-MIT-green.svg)](https://opensource.org/licenses/MIT)
[![License: CC0-1.0](https://img.shields.io/badge/License (for data)-CC0_1.0-lightgrey.svg)](http://creativecommons.org/publicdomain/zero/1.0/)

This package accesses and formats veterinary disease data from [WOAH WAHIS](https://wahis.woah.org/#/home). As of June 2024, WAHIS disease outbreak data is not available in a format conducive to automatic updates. EHA has an agreement with WOAH to access static data extracts, released via SharePoint, which we process here and upload to a public DoltHub (https://www.dolthub.com/repositories/ecohealthalliance/wahisdb).

In the future, WOAH plans to release a public-facing application program interface (API), which will facilitate automatic data extraction.

Data were last updated from static reports in March 2024. 

## Database Tables
- **wahis_epi_events** Summarizes high level event data, where each row is an independent event, as defined by the reporting country. `epi_event_id_unique` is the generated primary key. This table included hand-curated disease name standardization and taxonomy.
- **wahis_outbreaks** Detailed location and impact data for outbreak subevents (e.g., individual farms within a larger outbreak event). `report_outbreak_species_id_unique` is a generated unique primary key. This table can be joined with wahis_epi_events by `epi_event_id_unique`.
- **wahis_six_month_status** Disease status by 6-month semester. `unique_id` is a generated unique primary key.
- **wahis_six_month_controls** Control measures applied by disease and taxa by 6-month semester. `unique_id` is a generated unique primary key.
- **wahis_six_month_quantitative** Aggregated impact data from outbreak events reports AND six monthly reports on 6-month basis. `six_month_quantitative_unique_id` is a generated unique primary key.
- **disease_key** Lookup table for cleaning and standardizing disease names. Curated manually with cross reference to the Animal Disease Ontology (ANDO) (http://agroportal.lirmm.fr/ontologies/ANDO/?p=summary)
- **taxon_key** Lookup table for cleaning and standardizing taxon names. Manually curated.
- **schema_table** Description of each table within the database.
- **schema_fields** Description of each field within the database.


## Repository Structure and Reproducibility

-   `wahisdb/` contains the dolt database. See instructions below. 
-   `R/` contains functions used in this analysis. 
-   This project uses the `targets` package to create its analysis pipeline.  The steps are
    defined in the `_targets.R` file and the workflow can be executed by running `targets::tar_make()`.

## Dolt
-   Install and configure the database software, dolt: https://www.dolthub.com/blog/2020-02-03-dolt-and-dolthub-getting-started/
-   Install: sudo curl -L https://github.com/dolthub/dolt/releases/latest/download/install.sh | sudo bash
-   Provide credentials: `dolt config --global --add user.email YOU@DOMAIN.COM` and `dolt config --global --add user.name "YOUR NAME"`
Login: dolt login
-   Copy key to https://www.dolthub.com/settings/credentials
-   Clone the dolt database: dolt clone ecohealthalliance/wahisdb

## renv
-   This project uses the [{renv}](https://rstudio.github.io/renv/) framework to 
    record R package dependencies and versions. Packages and versions used are recorded in 
    `renv.lock` and code used to manage dependencies is in `renv/` and other files
    in the root project directory.  On starting an R session in the working directory, run `renv::restore()` to install R package dependencies.
